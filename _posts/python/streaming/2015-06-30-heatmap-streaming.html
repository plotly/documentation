---
permalink: python/heatmap-streaming/
description: Streaming Heatmaps in Plotly with Python.
name: Streaming in Plotly
has_thumbnail: true
thumbnail: 
layout: user-guide
name: Streaming with Heatmaps
language: python
title: Streaming with Heatmaps with Plotly
has_thumbnail: false
page_type: u-guide
order: 4
---
{% raw %}
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="New-to-Plotly?">New to Plotly?<a class="anchor-link" href="#New-to-Plotly?">&#182;</a></h4><p>Plotly's Python library is free and open source! <a href="https://plot.ly/python/getting-started/">Get started</a> by downloading the client and <a href="https://plot.ly/python/getting-started/">reading the primer</a>.
<br>You can set up Plotly to work in <a href="https://plot.ly/python/getting-started/#initialization-for-online-plotting">online</a> or <a href="https://plot.ly/python/getting-started/#initialization-for-offline-plotting">offline</a> mode, or in <a href="https://plot.ly/python/getting-started/#start-plotting-online">jupyter notebooks</a>.
<br>We also have a quick-reference <a href="https://images.plot.ly/plotly-documentation/images/python_cheat_sheet.pdf">cheatsheet</a> (new!) to help you get started!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Version-Check">Version Check<a class="anchor-link" href="#Version-Check">&#182;</a></h4><p>Check which version is installed on your machine and please upgrade if needed.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">plotly</span>
<span class="n">plotly</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[1]:</div>



<div class="output_text output_subarea output_execute_result">
<pre>&#39;2.0.6&#39;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Getting-Set-Up">Getting Set Up<a class="anchor-link" href="#Getting-Set-Up">&#182;</a></h4><p>As usual, get your streaming ids and assign <code>stream_id</code> to one of your streaming ids in your credentials file.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.plotly</span> <span class="kn">as</span> <span class="nn">py</span>
<span class="kn">import</span> <span class="nn">plotly.tools</span> <span class="kn">as</span> <span class="nn">tls</span>
<span class="kn">import</span> <span class="nn">plotly.figure_factory</span> <span class="kn">as</span> <span class="nn">ff</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="kn">as</span> <span class="nn">go</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">stream_ids</span> <span class="o">=</span> <span class="n">tls</span><span class="o">.</span><span class="n">get_credentials_file</span><span class="p">()[</span><span class="s1">&#39;stream_ids&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ct8pa6ekit&#39;</span><span class="p">]</span>

<span class="c1"># Get stream id from stream id list </span>
<span class="n">stream_id</span> <span class="o">=</span> <span class="n">stream_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Make instance of stream id object </span>
<span class="n">stream_1</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Stream</span><span class="p">(</span>
    <span class="n">token</span><span class="o">=</span><span class="n">stream_id</span><span class="p">,</span>
    <span class="n">maxpoints</span><span class="o">=</span><span class="mi">80</span>
<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Initialize-Heatmap">Initialize Heatmap<a class="anchor-link" href="#Initialize-Heatmap">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.66</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">text</span><span class="o">=</span><span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;RANDOM&#39;</span><span class="p">,</span> <span class="s1">&#39;COLORS&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;LOTS&#39;</span><span class="p">,</span> <span class="s1">&#39;OF&#39;</span><span class="p">],</span>
<span class="p">]</span>

<span class="n">colorscale_name</span> <span class="o">=</span> <span class="s1">&#39;Rainbow&#39;</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">create_annotated_heatmap</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">stream_1</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale_name</span><span class="p">,</span> <span class="n">annotation_text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>

<span class="k">for</span> <span class="n">heatmap_cell</span> <span class="ow">in</span> <span class="n">fig</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="s1">&#39;annotations&#39;</span><span class="p">]:</span>
    <span class="n">heatmap_cell</span><span class="p">[</span><span class="s1">&#39;font&#39;</span><span class="p">][</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>
    
<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;annotated_heatmap-streaming&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[3]:</div>


<div class="output_html rendered_html output_subarea output_execute_result">
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~streaming-demos/135.embed" height="525px" width="100%"></iframe>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Start-Streaming-Annotated-Heatmap">Start Streaming Annotated Heatmap<a class="anchor-link" href="#Start-Streaming-Annotated-Heatmap">&#182;</a></h4><p>As well as being able to write data to traces in a streaming example, you can also stream changes to the <code>Layout</code> of a plotly figure.</p>
<p><code>s.write()</code> can take a figure object (eg. <code>go.Scatter()</code>, <code>go.Heatmap()</code>, etc) and can also take a <code>go.Layout()</code> object as one of its arguments. This will enable you to change the annotation text in an annotated heatmap, for example.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">py</span><span class="o">.</span><span class="n">Stream</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">plotly.colors</span> <span class="kn">as</span> <span class="nn">colors</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>

    <span class="n">x_1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
    <span class="n">y_1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
    <span class="n">x_2</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
    <span class="n">y_2</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>

    <span class="n">z</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x_1</span><span class="p">,</span> <span class="n">y_1</span><span class="p">],</span> <span class="p">[</span><span class="n">x_2</span><span class="p">,</span> <span class="n">y_2</span><span class="p">]]</span>
    
    <span class="c1"># add text to annotated heatmap</span>
    <span class="n">rainbow_scale</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">PLOTLY_SCALES</span><span class="p">[</span><span class="n">colorscale_name</span><span class="p">]</span>
    <span class="n">scale_values</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">colorscale_to_scale</span><span class="p">(</span><span class="n">rainbow_scale</span><span class="p">)</span>
    <span class="n">text_vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">sum</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rainbow_scale</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">lowindex</span> <span class="o">=</span> <span class="n">rainbow_scale</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">highindex</span> <span class="o">=</span> <span class="n">rainbow_scale</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">lowcolor</span> <span class="o">=</span> <span class="n">rainbow_scale</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">highcolor</span> <span class="o">=</span> <span class="n">rainbow_scale</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">break</span>

        <span class="n">inter_color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">find_intermediate_color</span><span class="p">(</span>
            <span class="n">colors</span><span class="o">.</span><span class="n">unlabel_rgb</span><span class="p">(</span><span class="n">lowcolor</span><span class="p">),</span>
            <span class="n">colors</span><span class="o">.</span><span class="n">unlabel_rgb</span><span class="p">(</span><span class="n">highcolor</span><span class="p">),</span>
            <span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="n">lowindex</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">highindex</span> <span class="o">-</span> <span class="n">lowindex</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">rounded_color</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">inter_color</span><span class="p">))</span>
        <span class="n">cell_color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">label_rgb</span><span class="p">(</span><span class="n">rounded_color</span><span class="p">)</span>  
        <span class="n">text_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell_color</span><span class="p">)</span>
    
    <span class="n">annotations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;font&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#000000&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
         <span class="s1">&#39;showarrow&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
         <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">text_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
         <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="s1">&#39;xref&#39;</span><span class="p">:</span> <span class="s1">&#39;x1&#39;</span><span class="p">,</span>
         <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="s1">&#39;yref&#39;</span><span class="p">:</span> <span class="s1">&#39;y1&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;font&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#000000&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
         <span class="s1">&#39;showarrow&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
         <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">text_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
         <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
         <span class="s1">&#39;xref&#39;</span><span class="p">:</span> <span class="s1">&#39;x1&#39;</span><span class="p">,</span>
         <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="s1">&#39;yref&#39;</span><span class="p">:</span> <span class="s1">&#39;y1&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;font&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#000000&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
         <span class="s1">&#39;showarrow&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
         <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">text_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
         <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
         <span class="s1">&#39;xref&#39;</span><span class="p">:</span> <span class="s1">&#39;x1&#39;</span><span class="p">,</span>
         <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
         <span class="s1">&#39;yref&#39;</span><span class="p">:</span> <span class="s1">&#39;y1&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;font&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;#000000&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">},</span>
         <span class="s1">&#39;showarrow&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
         <span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">text_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
         <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
         <span class="s1">&#39;xref&#39;</span><span class="p">:</span> <span class="s1">&#39;x1&#39;</span><span class="p">,</span>
         <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
         <span class="s1">&#39;yref&#39;</span><span class="p">:</span> <span class="s1">&#39;y1&#39;</span><span class="p">}</span>
    <span class="p">]</span>
    
    <span class="n">s</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">),</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">annotations</span><span class="o">=</span><span class="n">annotations</span><span class="p">))</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  
<span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can see this stream live below:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">tls</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="s1">&#39;streaming-demos&#39;</span><span class="p">,</span><span class="s1">&#39;135&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[5]:</div>


<div class="output_html rendered_html output_subarea output_execute_result">
<iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plot.ly/~streaming-demos/135.embed" height="525" width="100%"></iframe>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="References">References<a class="anchor-link" href="#References">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">py</span><span class="o">.</span><span class="n">Stream</span><span class="o">.</span><span class="n">write</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_subarea output_stream output_stdout output_text">
<pre>Help on method write in module plotly.plotly.plotly:

write(self, trace, layout=None, validate=True, reconnect_on=(200, &#39;&#39;, 408)) unbound plotly.plotly.plotly.Stream method
    Write to an open stream.
    
    Once you&#39;ve instantiated a &#39;Stream&#39; object with a &#39;stream_id&#39;,
    you can &#39;write&#39; to it in real time.
    
    positional arguments:
    trace - A valid plotly trace object (e.g., Scatter, Heatmap, etc.).
            Not all keys in these are `stremable` run help(Obj) on the type
            of trace your trying to stream, for each valid key, if the key
            is streamable, it will say &#39;streamable = True&#39;. Trace objects
            must be dictionary-like.
    
    keyword arguments:
    layout (default=None) - A valid Layout object
                            Run help(plotly.graph_objs.Layout)
    validate (default = True) - Validate this stream before sending?
                                This will catch local errors if set to
                                True.
    
    Some valid keys for trace dictionaries:
        &#39;x&#39;, &#39;y&#39;, &#39;text&#39;, &#39;z&#39;, &#39;marker&#39;, &#39;line&#39;
    
    Examples:
    &gt;&gt;&gt; write(dict(x=1, y=2))  # assumes &#39;scatter&#39; type
    &gt;&gt;&gt; write(Bar(x=[1, 2, 3], y=[10, 20, 30]))
    &gt;&gt;&gt; write(Scatter(x=1, y=2, text=&#39;scatter text&#39;))
    &gt;&gt;&gt; write(Scatter(x=1, y=3, marker=Marker(color=&#39;blue&#39;)))
    &gt;&gt;&gt; write(Heatmap(z=[[1, 2, 3], [4, 5, 6]]))
    
    The connection to plotly&#39;s servers is checked before writing
    and reconnected if disconnected and if the response status code
    is in `reconnect_on`.
    
    For more help, see: `help(plotly.plotly.Stream)`
    or see examples and tutorials here:
    http://nbviewer.ipython.org/github/plotly/python-user-guide/blob/master/s7_streaming/s7_streaming.ipynb

</pre>
</div>
</div>

</div>
</div>

</div>
 

{% endraw %}