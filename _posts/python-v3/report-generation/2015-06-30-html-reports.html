---
permalink: python/v3/html-reports/
description: How to make HTML reports with Python, Pandas, and Plotly Graphs.
name: Python HTML Reports
thumbnail: thumbnail/ipython_10_html_report.jpg
layout: base
page_type: example_index
display_as: report_generation
order: 1
language: python/v3
---
{% raw %}
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Generate HTML reports with D3 graphs<br>using Python, Plotly, and Pandas</h2>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="https://www.dropbox.com/s/egoxoekkq5r2avh/report.html?dl=1">Download the example report generated by this script</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="d3.js">d3.js</a> is an amazing JavaScript library for creating interactive, online graphics and charts. Plotly lets you create d3.js charts using Python, R, or MATLAB. This IPython notebook shows you how to embed these charts in an HTML report that you can then share by email or host on a website.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Once you've created your report generation script, you can automate it with a task scheduler like <a href="http://moderndata.plot.ly/update-plotly-charts-with-cron-jobs-and-python/">cron</a> or Windows Task Manager, and  <a href="https://plot.ly/python/email-reports/">email it to yourself and your team</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[153]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">plotly</span> <span class="kn">as</span> <span class="nn">py</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">time</span> <span class="k">as</span> <span class="n">dt_tm</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span> <span class="k">as</span> <span class="n">dt_date</span>

<span class="kn">import</span> <span class="nn">plotly.plotly</span> <span class="kn">as</span> <span class="nn">py</span>
<span class="kn">import</span> <span class="nn">plotly.tools</span> <span class="kn">as</span> <span class="nn">plotly_tools</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="kn">as</span> <span class="nn">go</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;MPLCONFIGDIR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">matplotlib.finance</span> <span class="kn">import</span> <span class="n">quotes_historical_yahoo</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Step-1:-Generate-2-graphs-and-2-tables">Step 1: Generate 2 graphs and 2 tables<a class="anchor-link" href="#Step-1:-Generate-2-graphs-and-2-tables">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="First-graph:-2014-Apple-stock-data-with-moving-average">First graph: 2014 Apple stock data with moving average<a class="anchor-link" href="#First-graph:-2014-Apple-stock-data-with-moving-average">&#182;</a></h5>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's grab Apple stock data using the <a href="http://matplotlib.org/api/finance_api.html">matplotlib finance</a> model from 2014, then take a moving average with a <a href="http://docs.scipy.org/doc/numpy/reference/generated/numpy.convolve.html">numpy convolution</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[154]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ma</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">moving_average</span><span class="p">(</span><span class="n">interval</span><span class="p">,</span> <span class="n">window_size</span><span class="p">):</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">window_size</span><span class="p">))</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">window_size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">interval</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="s1">&#39;same&#39;</span><span class="p">)</span>

<span class="n">date1</span> <span class="o">=</span> <span class="n">dt_date</span><span class="p">(</span> <span class="mi">2014</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
<span class="n">date2</span> <span class="o">=</span> <span class="n">dt_date</span><span class="p">(</span> <span class="mi">2014</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span> <span class="p">)</span>
<span class="n">quotes</span> <span class="o">=</span> <span class="n">quotes_historical_yahoo</span><span class="p">(</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="n">date1</span><span class="p">,</span> <span class="n">date2</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">quotes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span> <span class="s2">&quot;Couldn&#39;t connect to yahoo trading database&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quotes</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quotes</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">:</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromordinal</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">))</span>\
                <span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span> <span class="c1"># Plotly timestamp format</span>
    <span class="n">ma</span> <span class="o">=</span> <span class="n">moving_average</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now graph the data with Plotly. See here for Plotly's <a href="https://plot.ly/python/line-and-scatter/">line plot syntax</a> and here for <a href="https://plot.ly/python/getting-started/">getting started</a> with the Plotly Python client.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[155]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">xy_data</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;AAPL&#39;</span> <span class="p">)</span>
<span class="c1"># vvv clip first and last points of convolution</span>
<span class="n">mov_avg</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">ma</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">],</span> \
                  <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Moving average&#39;</span> <span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">xy_data</span><span class="p">,</span> <span class="n">mov_avg</span><span class="p">]</span>

<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;apple stock moving average&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[155]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<iframe id="igraph" scrolling="no" style="border:none;"seamless="seamless" src="https://plot.ly/~jackp/1841.embed" height="525" width="100%"></iframe>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Save the plot URL - we'll use it when generating the report later.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[157]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">first_plot_url</span> <span class="o">=</span> <span class="n">py</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;apple stock moving average&#39;</span><span class="p">,</span> <span class="n">auto_open</span><span class="o">=</span><span class="bp">False</span><span class="p">,)</span>
<span class="k">print</span> <span class="n">first_plot_url</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>https://plot.ly/~jackp/1841
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Second-graph:-Scatter-matrix-of-2014-technology-and-CPG-stocks">Second graph: Scatter matrix of 2014 technology and CPG stocks<a class="anchor-link" href="#Second-graph:-Scatter-matrix-of-2014-technology-and-CPG-stocks">&#182;</a></h5>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's use the Pandas package and Plotly subplots to compare different tech. and CPG stocks in 2014.<br>
This graph was inspired by <a href="http://nbviewer.ipython.org/github/twiecki/financial-analysis-python-tutorial/blob/master/1.%20Pandas%20Basics.ipynb">this IPython notebook</a> and GitHub user <a href="https://github.com/twiecki">twiecki</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">tickers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;GE&#39;</span><span class="p">,</span> <span class="s1">&#39;IBM&#39;</span><span class="p">,</span> <span class="s1">&#39;KO&#39;</span><span class="p">,</span> <span class="s1">&#39;MSFT&#39;</span><span class="p">,</span> <span class="s1">&#39;PEP&#39;</span><span class="p">]</span>
<span class="n">prices</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ticker</span> <span class="ow">in</span> <span class="n">tickers</span><span class="p">:</span>
    <span class="n">quotes</span> <span class="o">=</span> <span class="n">quotes_historical_yahoo</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">date1</span><span class="p">,</span> <span class="n">date2</span><span class="p">)</span>
    <span class="n">prices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">quotes</span><span class="p">]</span> <span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We have all the stock prices in a list of lists - use the code snippet below to convert this into a Pandas dataframe.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span> <span class="n">prices</span> <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">tickers</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[6]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AAPL</th>
      <th>GE</th>
      <th>IBM</th>
      <th>KO</th>
      <th>MSFT</th>
      <th>PEP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td> 77.746778</td>
      <td> 26.907695</td>
      <td> 182.770157</td>
      <td> 39.926650</td>
      <td> 36.354938</td>
      <td> 80.626950</td>
    </tr>
    <tr>
      <th>1</th>
      <td> 77.352163</td>
      <td> 26.578632</td>
      <td> 181.429182</td>
      <td> 39.493584</td>
      <td> 36.212300</td>
      <td> 79.843327</td>
    </tr>
    <tr>
      <th>2</th>
      <td> 75.193398</td>
      <td> 26.716354</td>
      <td> 182.712734</td>
      <td> 39.303899</td>
      <td> 35.870869</td>
      <td> 79.922217</td>
    </tr>
    <tr>
      <th>3</th>
      <td> 76.158839</td>
      <td> 26.543525</td>
      <td> 181.968752</td>
      <td> 39.297371</td>
      <td> 35.362131</td>
      <td> 80.323900</td>
    </tr>
    <tr>
      <th>4</th>
      <td> 75.389380</td>
      <td> 26.415215</td>
      <td> 184.837731</td>
      <td> 39.265478</td>
      <td> 35.043624</td>
      <td> 81.017502</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Use Plotly's <a href="https://plot.ly/python/overview/">get_subplots()</a> routine to generate an empty matrix of 6x6 subplots. We'll fill these in by plotting all stock ticker combinations against each other (ie, General Electric stock versus Apple stock)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[122]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plotly_tools</span><span class="o">.</span><span class="n">get_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">print_grid</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">horizontal_spacing</span><span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">vertical_spacing</span><span class="o">=</span> <span class="mf">0.05</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>This is the format of your plot grid!
[31]	[32]	[33]	[34]	[35]	[36]
[25]	[26]	[27]	[28]	[29]	[30]
[19]	[20]	[21]	[22]	[23]	[24]
[13]	[14]	[15]	[16]	[17]	[18]
[7]	[8]	[9]	[10]	[11]	[12]
[1]	[2]	[3]	[4]	[5]	[6]

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[143]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">kde_scipy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_grid</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Kernel Density Estimation with Scipy&quot;&quot;&quot;</span>
    <span class="c1"># From https://jakevdp.github.io/blog/2013/12/01/kernel-density-estimation/</span>
    <span class="c1"># Note that scipy weights its bandwidth by the covariance of the</span>
    <span class="c1"># input data.  To make the results comparable to the other methods,</span>
    <span class="c1"># we divide the bandwidth by the sample standard deviation here.</span>
    <span class="n">kde</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="n">bandwidth</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kde</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x_grid</span><span class="p">)</span>

<span class="n">subplots</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">37</span><span class="p">)</span>
<span class="n">sp_index</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">):</span>
    <span class="n">x_ticker</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">):</span>
        <span class="n">y_ticker</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="n">j</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">x_ticker</span><span class="p">]</span>
            <span class="n">x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
            <span class="n">sp</span> <span class="o">=</span> <span class="p">[</span> <span class="n">go</span><span class="o">.</span><span class="n">Histogram</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">histnorm</span><span class="o">=</span><span class="s1">&#39;probability density&#39;</span> <span class="p">),</span> \
                  <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="n">x_grid</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">kde_scipy</span><span class="p">(</span> <span class="n">x</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">(),</span> <span class="n">x_grid</span> <span class="p">),</span> \
                          <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">opacity</span><span class="o">=</span><span class="s1">&#39;0.5&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sp</span> <span class="o">=</span> <span class="p">[</span> <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span> <span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">x_ticker</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">y_ticker</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span> <span class="p">]</span>

        <span class="k">for</span> <span class="n">ea</span> <span class="ow">in</span> <span class="n">sp</span><span class="p">:</span>
            <span class="n">ea</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;{0} vs {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x_ticker</span><span class="p">,</span><span class="n">y_ticker</span><span class="p">),</span>\
                      <span class="n">xaxis</span><span class="o">=</span><span class="s1">&#39;x{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subplots</span><span class="p">[</span><span class="n">sp_index</span><span class="p">]),</span>\
                      <span class="n">yaxis</span><span class="o">=</span><span class="s1">&#39;y{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subplots</span><span class="p">[</span><span class="n">sp_index</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="n">sp_index</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">data</span> <span class="o">+=</span> <span class="n">sp</span>

<span class="c1"># Add x and y labels</span>
<span class="n">left_index</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">bottom_index</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">tk</span> <span class="ow">in</span> <span class="n">tickers</span><span class="p">:</span>
    <span class="n">fig</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="s1">&#39;xaxis{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">left_index</span><span class="p">)]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">title</span><span class="o">=</span><span class="n">tk</span> <span class="p">)</span>
    <span class="n">fig</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">][</span><span class="s1">&#39;yaxis{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bottom_index</span><span class="p">)]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">title</span><span class="o">=</span><span class="n">tk</span> <span class="p">)</span>
    <span class="n">left_index</span><span class="o">=</span><span class="n">left_index</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">bottom_index</span><span class="o">=</span><span class="n">bottom_index</span><span class="o">+</span><span class="mi">6</span>

<span class="c1"># Remove legend by updating &#39;layout&#39; key</span>
<span class="n">fig</span><span class="p">[</span><span class="s1">&#39;layout&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Major technology and CPG stock prices in 2014&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
<span class="n">py</span><span class="o">.</span><span class="n">iplot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;Major technology and CPG stock prices in 2014 - scatter matrix&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[143]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<iframe id="igraph" scrolling="no" style="border:none;"seamless="seamless" src="https://plot.ly/~jackp/2019.embed?width=975&height=975" height="1000" width="1000"></iframe>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Save the plot URL - we'll use it when generating the report later.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[145]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">second_plot_url</span> <span class="o">=</span> <span class="n">py</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">auto_open</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>\
                          <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;Major technology and CPG stock prices in 2014 - scatter matrix&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">second_plot_url</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>https://plot.ly/~jackp/2019
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="2-summary-tables:-One-using-Pandas-and-one-using-HTML">2 summary tables: One using Pandas and one using HTML<a class="anchor-link" href="#2-summary-tables:-One-using-Pandas-and-one-using-HTML">&#182;</a></h5>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First table: Use Pandas <a href="http://pandas.pydata.org/pandas-docs/version/0.15.1/generated/pandas.DataFrame.to_html.html">to_html()</a> routine to convert Pandas data frame to HTML table. Replace default table styling with <a href="http://getbootstrap.com/css">Bootstrap</a> table styling.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[175]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">summary_table_1</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">summary_table_1</span> <span class="o">=</span> <span class="n">summary_table_1</span>\
    <span class="o">.</span><span class="n">to_html</span><span class="p">()</span>\
    <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;table border=&quot;1&quot; class=&quot;dataframe&quot;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;table class=&quot;table table-striped&quot;&gt;&#39;</span><span class="p">)</span> <span class="c1"># use bootstrap styling</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Second table: Build table as an HTML string. Use <a href="http://getbootstrap.com/css">Bootstrap</a> for table styling.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[135]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">summary_table_2</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;&lt;table class=&quot;table table-striped&quot;&gt;</span>
<span class="s1">&lt;th&gt;Ticker&lt;/th&gt;&lt;th&gt;Full name&lt;/th&gt;</span>
<span class="s1">&lt;tr&gt;</span>
<span class="s1">    &lt;td&gt;AAPL&lt;/td&gt;</span>
<span class="s1">    &lt;td&gt;&lt;a href=&quot;http://finance.yahoo.com/q?s=AAPL&quot;&gt;Apple Inc&lt;/a&gt;&lt;/td&gt;</span>
<span class="s1">&lt;/tr&gt;</span>
<span class="s1">&lt;tr&gt;</span>
<span class="s1">    &lt;td&gt;GE&lt;/td&gt;</span>
<span class="s1">    &lt;td&gt;&lt;a href=&quot;http://finance.yahoo.com/q?s=GE&quot;&gt;General Electric Company&lt;/a&gt;&lt;/td&gt;</span>
<span class="s1">&lt;/tr&gt;</span>
<span class="s1">&lt;tr&gt;</span>
<span class="s1">    &lt;td&gt;IBM&lt;/td&gt;</span>
<span class="s1">    &lt;td&gt;&lt;a href=&quot;http://finance.yahoo.com/q?s=IBM&quot;&gt;International Business Machines Corp.&lt;/a&gt;&lt;/td&gt;</span>
<span class="s1">&lt;/tr&gt;</span>
<span class="s1">&lt;tr&gt;</span>
<span class="s1">    &lt;td&gt;KO&lt;/td&gt;</span>
<span class="s1">    &lt;td&gt;&lt;a href=&quot;http://finance.yahoo.com/q?s=KO&quot;&gt;The Coca-Cola Company&lt;/a&gt;&lt;/td&gt;</span>
<span class="s1">&lt;/tr&gt;</span>
<span class="s1">&lt;tr&gt;</span>
<span class="s1">    &lt;td&gt;MSFT&lt;/td&gt;</span>
<span class="s1">    &lt;td&gt;&lt;a href=&quot;http://finance.yahoo.com/q?s=MSFT&quot;&gt;Microsoft Corporation&lt;/a&gt;&lt;/td&gt;</span>
<span class="s1">&lt;/tr&gt;</span>
<span class="s1">&lt;tr&gt;</span>
<span class="s1">    &lt;td&gt;PEP&lt;/td&gt;</span>
<span class="s1">    &lt;td&gt;&lt;a href=&quot;http://finance.yahoo.com/q?s=PEP&quot;&gt;Pepsico, Inc.&lt;/a&gt;&lt;/td&gt;</span>
<span class="s1">&lt;/tr&gt;</span>
<span class="s1">&lt;/table&gt;</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="n">HTML</span><span class="p">(</span><span class="n">summary_table_2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[135]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<table class="table table-striped">
<th>Ticker</th><th>Full name</th>
<tr>
    <td>AAPL</td>
    <td><a href="http://finance.yahoo.com/q?s=AAPL">Apple Inc</a></td>
</tr>
<tr>
    <td>GE</td>
    <td><a href="http://finance.yahoo.com/q?s=GE">General Electric Company</a></td>
</tr>
<tr>
    <td>IBM</td>
    <td><a href="http://finance.yahoo.com/q?s=IBM">International Business Machines Corp.</a></td>
</tr>
<tr>
    <td>KO</td>
    <td><a href="http://finance.yahoo.com/q?s=KO">The Coca-Cola Company</a></td>
</tr>
<tr>
    <td>MSFT</td>
    <td><a href="http://finance.yahoo.com/q?s=MSFT">Microsoft Corporation</a></td>
</tr>
<tr>
    <td>PEP</td>
    <td><a href="http://finance.yahoo.com/q?s=PEP">Pepsico, Inc.</a></td>
</tr>
</table>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3>Step 2: Generate HTML report<br>as a string and write to file</h3>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is the last step. We have all of the plots and tables that we want to include in the report - now we build an HTML string with the plots and tables embedded.<br>Notice that the <a href="http://getbootstrap.com/css">Bootstrap</a> css library is included in the &lt;head&gt; for styling.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[184]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">html_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;html&gt;</span>
<span class="s1">    &lt;head&gt;</span>
<span class="s1">        &lt;link rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css&quot;&gt;</span>
<span class="s1">        &lt;style&gt;body{ margin:0 100; background:whitesmoke; }&lt;/style&gt;</span>
<span class="s1">    &lt;/head&gt;</span>
<span class="s1">    &lt;body&gt;</span>
<span class="s1">        &lt;h1&gt;2014 technology and CPG stock prices&lt;/h1&gt;</span>

<span class="s1">        &lt;!-- *** Section 1 *** ---&gt;</span>
<span class="s1">        &lt;h2&gt;Section 1: Apple Inc. (AAPL) stock in 2014&lt;/h2&gt;</span>
<span class="s1">        &lt;iframe width=&quot;1000&quot; height=&quot;550&quot; frameborder=&quot;0&quot; seamless=&quot;seamless&quot; scrolling=&quot;no&quot; </span><span class="se">\</span>
<span class="s1">src=&quot;&#39;&#39;&#39;</span> <span class="o">+</span> <span class="n">first_plot_url</span> <span class="o">+</span> <span class="s1">&#39;&#39;&#39;.embed?width=800&amp;height=550&quot;&gt;&lt;/iframe&gt;</span>
<span class="s1">        &lt;p&gt;Apple stock price rose steadily through 2014.&lt;/p&gt;</span>
<span class="s1">        </span>
<span class="s1">        &lt;!-- *** Section 2 *** ---&gt;</span>
<span class="s1">        &lt;h2&gt;Section 2: AAPL compared to other 2014 stocks&lt;/h2&gt;</span>
<span class="s1">        &lt;iframe width=&quot;1000&quot; height=&quot;1000&quot; frameborder=&quot;0&quot; seamless=&quot;seamless&quot; scrolling=&quot;no&quot; </span><span class="se">\</span>
<span class="s1">src=&quot;&#39;&#39;&#39;</span> <span class="o">+</span> <span class="n">second_plot_url</span> <span class="o">+</span> <span class="s1">&#39;&#39;&#39;.embed?width=1000&amp;height=1000&quot;&gt;&lt;/iframe&gt;</span>
<span class="s1">        &lt;p&gt;GE had the most predictable stock price in 2014. IBM had the highest mean stock price. </span><span class="se">\</span>
<span class="s1">The red lines are kernel density estimations of each stock price - the peak of each red lines </span><span class="se">\</span>
<span class="s1">corresponds to its mean stock price for 2014 on the x axis.&lt;/p&gt;</span>
<span class="s1">        &lt;h3&gt;Reference table: stock tickers&lt;/h3&gt;</span>
<span class="s1">        &#39;&#39;&#39;</span> <span class="o">+</span> <span class="n">summary_table_2</span> <span class="o">+</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        &lt;h3&gt;Summary table: 2014 stock statistics&lt;/h3&gt;</span>
<span class="s1">        &#39;&#39;&#39;</span> <span class="o">+</span> <span class="n">summary_table_1</span> <span class="o">+</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    &lt;/body&gt;</span>
<span class="s1">&lt;/html&gt;&#39;&#39;&#39;</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally, write the html string to a local file.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[185]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/home/jack/report.html&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html_string</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>


{% endraw %}
